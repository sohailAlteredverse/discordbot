import { ServiceError } from '@grpc/grpc-js';
import { InworldPacket as ProtoPacket } from '../../../proto/packets_pb';
import { ClientRequest, UserRequest } from '../../../proto/world-engine_pb';
import { ApiKey, Awaitable, Extension, GenerateSessionTokenFn, GetterSetter, InternalClientConfiguration } from '../common/data_structures';
import { InworldPacket } from '../entities/inworld_packet.entity';
import { Session } from '../entities/session.entity';
import { SessionToken } from '../entities/session_token.entity';
import { EventFactory } from '../factories/event';
interface ConnectionProps<InworldPacketT> {
    apiKey: ApiKey;
    name?: string;
    user?: UserRequest;
    client?: ClientRequest;
    config?: InternalClientConfiguration;
    sessionGetterSetter?: GetterSetter<Session>;
    onDisconnect?: () => void;
    onError?: (err: ServiceError) => void;
    onMessage?: (message: InworldPacketT) => Awaitable<void>;
    generateSessionToken?: GenerateSessionTokenFn;
    extension?: Extension<InworldPacketT>;
}
export interface QueueItem {
    getPacket: () => ProtoPacket;
    afterWriting?: (packet: ProtoPacket) => void;
}
export declare class ConnectionService<InworldPacketT extends InworldPacket = InworldPacket> {
    private state;
    private scene;
    private sessionToken;
    private stream;
    private connectionProps;
    private disconnectTimeoutId;
    private eventFactory;
    private intervals;
    private packetQueue;
    private tokenService;
    private engineService;
    private onDisconnect;
    private onError;
    private onMessage;
    constructor(props: ConnectionProps<InworldPacketT>);
    isActive(): boolean;
    isAutoReconnected(): boolean;
    generateSessionToken(): Promise<SessionToken>;
    openManually(): Promise<void>;
    close(): void;
    getEventFactory(): EventFactory;
    getCharactersList(): Promise<import("..").Character[]>;
    open(): Promise<void>;
    send(getPacket: () => ProtoPacket): Promise<InworldPacketT>;
    private write;
    private writeToStream;
    private loadScene;
    private getOrLoadSessionToken;
    private getOrLoadScene;
    private scheduleDisconnect;
    private cancelScheduler;
    private releaseQueue;
    private clearQueue;
    private convertPacketFromProto;
}
export {};
